{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/ppernias/tdl-spec/spec/schemas/learning_sequence.schema.json",
  "title": "TDL Learning Sequence",
  "description": "Schema for TDL Learning Sequence files - defines course structure and content",
  "type": "object",
  "required": ["sequence"],
  "properties": {
    "sequence": {
      "type": "object",
      "required": ["id", "name", "version", "extends", "tutor_profile", "learning_units"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
          "description": "Unique identifier in lowercase with hyphens"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Human-readable name of the course/sequence"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$",
          "description": "Semantic version"
        },
        "description": {
          "type": "string",
          "description": "Extended description of the course"
        },
        "author": {
          "type": "string",
          "description": "Name of the course author"
        },
        "license": {
          "type": "string",
          "description": "License for the course content (e.g., 'CC-BY-4.0')"
        },
        "extends": {
          "type": "string",
          "pattern": ".*\\.ya?ml$",
          "description": "Filename of the instructional model to inherit from"
        },
        "source_content": {
          "type": "array",
          "description": "External content files to use as reference material",
          "items": {
            "$ref": "#/$defs/source_content_item"
          }
        },
        "tutor_profile": {
          "$ref": "#/$defs/tutor_profile"
        },
        "behaviors": {
          "$ref": "#/$defs/behaviors"
        },
        "learning_units": {
          "type": "array",
          "minItems": 1,
          "description": "List of learning units (minimum 1 required)",
          "items": {
            "$ref": "#/$defs/learning_unit"
          }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "source_content_item": {
      "type": "object",
      "required": ["file"],
      "properties": {
        "file": {
          "type": "string",
          "description": "Filename of the content source"
        },
        "type": {
          "type": "string",
          "enum": ["reference", "embedded", "external"],
          "default": "reference",
          "description": "How the content is used"
        },
        "description": {
          "type": "string",
          "description": "Description of the content file"
        }
      },
      "additionalProperties": false
    },
    "tutor_profile": {
      "type": "object",
      "required": ["name", "personality"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Name of the tutor persona"
        },
        "personality": {
          "type": "string",
          "minLength": 20,
          "description": "Detailed description of the tutor's personality and communication style"
        }
      },
      "additionalProperties": true
    },
    "behaviors": {
      "type": "object",
      "properties": {
        "response_length": {
          "type": "string",
          "enum": ["short", "medium", "long"],
          "default": "medium",
          "description": "Preferred length of tutor responses"
        },
        "language": {
          "type": "string",
          "pattern": "^[a-z]{2}(-[A-Z]{2})?$",
          "description": "Language code (e.g., 'en', 'es', 'en-US')"
        },
        "formality": {
          "type": "string",
          "enum": ["formal", "conversational", "casual"],
          "default": "conversational",
          "description": "Tone of communication"
        },
        "use_emoji": {
          "type": "boolean",
          "default": false,
          "description": "Whether to use emojis in responses"
        },
        "code_examples": {
          "type": "boolean",
          "default": true,
          "description": "Whether to include code examples when relevant"
        }
      },
      "additionalProperties": true
    },
    "learning_unit": {
      "type": "object",
      "required": ["id", "title", "prompt"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^LU[0-9]+$",
          "description": "Learning unit identifier (e.g., 'LU1', 'LU2')"
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "description": "Title of the learning unit"
        },
        "objectives": {
          "type": "array",
          "description": "Learning objectives for this unit",
          "items": {
            "$ref": "#/$defs/objective"
          }
        },
        "prompt": {
          "type": "string",
          "minLength": 10,
          "description": "Instructions for the tutor about what to teach in this unit"
        },
        "source_sections": {
          "type": "array",
          "description": "References to sections in the content source file",
          "items": {
            "type": "string"
          }
        },
        "next": {
          "type": ["string", "null"],
          "description": "ID of the next learning unit, or null if this is the last unit"
        }
      },
      "additionalProperties": false
    },
    "objective": {
      "type": "object",
      "required": ["level", "description"],
      "properties": {
        "level": {
          "type": "string",
          "enum": ["remember", "understand", "apply", "analyze", "evaluate", "create"],
          "description": "Bloom's taxonomy level"
        },
        "description": {
          "type": "string",
          "minLength": 5,
          "description": "Description of what the student will be able to do"
        }
      },
      "additionalProperties": false
    }
  }
}
